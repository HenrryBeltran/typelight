function A(n){n.charIndex++,n.totalIndex++}function J(n,e){if(n.wordIndex===0&&n.charIndex===0)return;if(n.charIndex===0){n.wordIndex--,n.totalIndex--,n.charIndex=e.children[n.wordIndex].children.length;return}n.totalIndex--,n.charIndex--}function P(n,e){if(n.charIndex===0)return;if(e.children[n.wordIndex].children[n.charIndex]!==void 0)n.incorrectCharacters++;n.wordIndex++,n.totalIndex++,n.charIndex=0}function Q(n,e){if(n.wordIndex===0&&n.charIndex===0)return;if(n.charIndex!==0){n.totalIndex-=e.children[n.wordIndex].children.length,n.charIndex=0;return}n.wordIndex--,n.charIndex=0}function X(n,e){if(e.children[n.wordIndex].children[n.charIndex-1].classList.contains("wrong"))n.incorrectCharacters++}function w(n,e,d=!1,x=!1){let l=e[n.wordIndex].lineIndex;if(n.lineIndex=l,d&&x){n.lastLineIndex=l;return}if(d&&l>n.lastLineIndex)n.lastLineIndex=l}function j(n,e,d){let x=d.children[n.wordIndex],l=n.lastLineIndex-n.lineIndex,i=n.lastLineIndex-1,h=e.find((I)=>I.lineIndex===n.lineIndex)?.word||null,f=e.find((I)=>I.lineIndex===i)?.word||null;if(h===null||f===null)return!0;if(l<2&&n.charIndex===0&&x===f)return!1;return!0}var D=0;function B(n,e,d,x=!1){let l=d.parentElement.getBoundingClientRect().width,i=d.children,h=i.length,f=x?0:e.length;if(x)e.length=0,n.numberOfLines=0,D=0;let I=n.numberOfLines;for(let c=f;c<h;c++){let g=i[c],r=g.getBoundingClientRect();if(D+r.width<l)D+=r.width;else I++,D=r.width;e.push({lineIndex:I,word:g})}n.numberOfLines=I}function Z(n){let e="";if(n.ctrlKey)e+="control";if(n.metaKey)e+="meta";if(n.shiftKey)e+="shift";if(n.altKey)e+="alt";if(n.key==="ArrowLeft")n.preventDefault();if(n.key==="ArrowRight")n.preventDefault();if(n.key==="Backspace"){if(e.length>1)return n.preventDefault(),e+"Backspace";return e+"backspace"}if(n.key===" ")return n.preventDefault(),"space";return e+n.key}function _(n,e){let d=0;for(let x=0;x<e;x++){let i=n.children[x].classList;if(i.contains("completed")&&!i.contains("wrong"))d++}return d}function M(n,e,d,x,l,i,h){e.timeoutId=null,e.startTime=null,e.endTime=null,e.isRunning=!1,e.isFinished=!1,n.numberOfLines=0,n.lineIndex=0,n.lastLineIndex=0,n.numberOfWords=0,n.numberOfNewWords=0,n.wordIndex=0,n.charIndex=0,n.totalIndex=0,n.correctWords=0,n.incorrectCharacters=0,d.length=0,x.innerHTML="",l.innerText="60",i.focus(),h()}function U(n,e,d){let x=(n-e)/1000;return d/x*60}function W(n,e,d){let x=(n-e)/1000;return d/5/(x/60)}function K(n,e){return((n-e)/n*100).toFixed(2)}function xn(n){let e=new Date(n),d={month:"short",day:"2-digit",weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1},l=new Intl.DateTimeFormat("en-US",d).formatToParts(e),i={};for(let h=0;h<l.length;h++)i[l[h].type]=l[h].value;return`${i.month} ${i.day}, ${i.weekday} - ${i.hour}:${i.minute}`}function hn(n){let e=Date.now(),d=new Date(e-performance.now()+n),x=String(d.getHours()).padStart(2,"0"),l=String(d.getMinutes()).padStart(2,"0"),i=String(d.getSeconds()).padStart(2,"0"),h=String(d.getMilliseconds()).padStart(3,"0");return`${x}:${l}:${i}.${h}`}function p(n,e,d){let x=d.children[e.wordIndex],l=x.children[e.charIndex],i=d.parentElement.getBoundingClientRect();if(!l){let f=x.children[e.charIndex-1];if(!f)return;let I=f.getBoundingClientRect();n.style.transform=`translate(${I.x+I.width-i.x}px, ${I.y-i.y}px)`;return}let h=l.getBoundingClientRect();if(n.style.transform=`translate(${h.x-i.x}px, ${h.y-i.y}px)`,e.totalIndex===1)n.classList.add("typing")}function G(n,e,d){let x=d.children[e.wordIndex],l=x.children[e.charIndex-1];if(l)if(l.textContent===n){if(l.classList.add("typed"),e.charIndex===x.children.length)x.classList.add("completed")}else l.classList.add("wrong"),x.classList.add("wrong");else{let i=document.createElement("letter");i.innerText=n,i.classList.add("extra","wrong"),x.classList.add("wrong"),x.appendChild(i)}}function v(n,e){let d=e.children[n.wordIndex],x=d.children[n.charIndex];if(!x)return;if(x.classList.contains("extra")){x.remove();return}d.classList.remove("completed"),x.classList.remove("typed","wrong")}function T(n,e,d){let x=e.children[n.wordIndex],l=d.value.length-x.children.length;d.value=d.value.slice(0,l);let i=e.children[n.wordIndex].children;for(let h=i.length-1;h>=0;h--){let f=i[h];if(f.classList.contains("extra")){f.remove();continue}f.classList.remove("typed","wrong")}}function F(n,e){let d=e.children[n.wordIndex],x=d.children,l=x.length,i=!1;for(let h=0;h<l;h++)if(x[h].classList.contains("wrong")){i=!0;break}if(!i)d.classList.remove("wrong")}function N(n,e){let d=e.children[0].getBoundingClientRect().height;if(n.lastLineIndex>1)e.style.transform=`translateY(-${d*(n.lastLineIndex-1)}px)`}function $(n,e){let d=n.getBoundingClientRect();e.style.transform=`translate(${d.x}px, ${d.y}px)`}function b(n,e,d,x,l=!0){for(let i=0;i<e;i++){let h=Math.floor(Math.random()*250),f=n[h],I=document.createElement("div");I.classList.add("word");let c=f.split(""),g=c.length;for(let r=0;r<g;r++){let L=c[r],o=document.createElement("letter");o.innerText=L,I.append(o)}d.numberOfWords++,x.append(I)}if(!l)d.numberOfNewWords+=e}function O(n,e,d,x,l,i,h,f,I,c,g,r){if(d.addEventListener("click",()=>{l.focus(),i.classList.add("focus")}),window.addEventListener("resize",()=>{$(d,l),B(c,I,d,!0),w(c,I,!0,!0),N(c,d),p(i,c,d)}),l.addEventListener("focus",()=>{i.classList.add("focus")}),l.addEventListener("blur",()=>{i.classList.remove("focus")}),/Android/i.test(navigator.userAgent))l.addEventListener("beforeinput",(L)=>{if(L.inputType==="deleteContentBackward"){L.preventDefault(),(f.backspace||f.default)("backspace"),p(i,c,d),F(c,d);return}}),l.addEventListener("input",()=>{let o=l.value.slice(-1),R=o;if(o===" ")R="space";if((f[R]||f.default)(R),l.value="",!g.isRunning&&R.length===1&&R!==" ")g.isRunning=!0,g.startTime=performance.now(),g.startTest();p(i,c,d),F(c,d)});else l.addEventListener("keydown",(L)=>{r.key=L.key,r.keyCode=L.keyCode,r.ctrl=L.ctrlKey,r.shift=L.shiftKey,r.alt=L.altKey;let o=Z(L);if((f[o]||f.default)(L.key),p(i,c,d),F(c,d),!g.isRunning&&L.key.length===1&&L.key!==" ")g.isRunning=!0,g.startTime=performance.now(),g.startTest()});h.addEventListener("click",()=>{M(c,g,I,d,x,l,()=>{b(n,e,c,d,!0),$(d,l),B(c,I,d,!0),w(c,I,!0,!0),N(c,d),p(i,c,d)})})}function E(n,e,d,x,l,i,h){e.default=(f)=>{if(f.length!==1)return;A(i),G(f,i,d),X(i,d)},e.space=()=>{P(i,d),w(i,l,!0),N(i,d);let f=i.numberOfWords*0.5;if(i.wordIndex>=f)b(n,h,i,d,!1),B(i,l,d)},e.backspace=()=>{if(j(i,l,d))J(i,d),w(i,l),v(i,d)},e.altBackspace=()=>{if(j(i,l,d))Q(i,d),T(i,d,x)},e.controlBackspace=e.altBackspace,e.metaBackspace=e.altBackspace}var z=document.querySelector("#counter"),y=document.querySelector(".words"),V=document.querySelector("#typing-input"),H=document.querySelector("#caret"),a=document.querySelector("#restart-test"),Y=[],C={numberOfLines:0,lineIndex:0,lastLineIndex:0,numberOfWords:0,numberOfNewWords:0,wordIndex:0,charIndex:0,totalIndex:0,correctWords:0,incorrectCharacters:0},k={timeoutId:null,startTime:null,endTime:null,startTest:(n)=>{},isRunning:!1,isFinished:!1},m={controlBackspace:(n)=>{},metaBackspace:(n)=>{},altBackspace:(n)=>{},space:(n)=>{},backspace:(n)=>{},default:(n)=>{}},s={key:"",keyCode:"",ctrl:"",shift:"",alt:""},u=150,t=150,S=await fetch("/words.json"),q=await S.json();b(q,u,C,y);$(y,V);B(C,Y,y,!0);O(q,u,y,z,V,H,a,m,Y,C,k,s);E(q,m,y,V,Y,C,t);p(H,C,y);k.startTest=()=>{dn(),k.timeoutId=setTimeout(()=>{k.endTime=performance.now(),k.isFinished=!0,V.blur(),C.correctWords=_(y,C.numberOfWords);let n=Math.round(U(k.endTime,k.startTime,C.correctWords)),e=Math.round(W(k.endTime,k.startTime,C.totalIndex)),d=K(C.totalIndex,C.incorrectCharacters),x={wpm:n,rawWPM:e,accuracy:d,timestamp:Date.now()};nn(x),window.location.href=`${window.location.origin}/results`},60000)};function nn(n){let d=JSON.parse(localStorage.getItem("typingStats")||"[]");if(d.length>=1e4)d.shift();d.push(n),localStorage.setItem("typingStats",JSON.stringify(d))}async function dn(){for(let n=60;n>0;n--)if(k.isRunning)z.innerText=n.toString(),await new Promise((e)=>setTimeout(e,1000));else return;z.innerText="0"}
