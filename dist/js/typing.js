function z(n){n.charIndex++,n.totalIndex++}function W(n,d){if(n.wordIndex===0&&n.charIndex===0)return;if(n.charIndex===0){n.wordIndex--,n.totalIndex--,n.charIndex=d.children[n.wordIndex].children.length;return}n.totalIndex--,n.charIndex--}function Y(n,d){if(n.charIndex===0)return;if(d.children[n.wordIndex].children[n.charIndex]!==void 0)n.incorrectCharacters++;n.wordIndex++,n.totalIndex++,n.charIndex=0}function j(n,d){if(n.wordIndex===0&&n.charIndex===0)return;if(n.charIndex!==0){n.totalIndex-=d.children[n.wordIndex].children.length,n.charIndex=0;return}n.wordIndex--,n.charIndex=0}function A(n,d){if(d.children[n.wordIndex].children[n.charIndex-1].classList.contains("wrong"))n.incorrectCharacters++}function w(n,d,e=!1,x=!1){let l=d[n.wordIndex].lineIndex;if(n.lineIndex=l,e&&x){n.lastLineIndex=l;return}if(e&&l>n.lastLineIndex)n.lastLineIndex=l}function V(n,d,e){let x=e.children[n.wordIndex],l=n.lastLineIndex-n.lineIndex,i=n.lastLineIndex-1,h=d.find((r)=>r.lineIndex===n.lineIndex)?.word||null,f=d.find((r)=>r.lineIndex===i)?.word||null;if(h===null||f===null)return!0;if(l<2&&n.charIndex===0&&x===f)return!1;return!0}var D=0;function B(n,d,e,x=!1){let l=e.parentElement.getBoundingClientRect().width,i=e.children,h=i.length,f=x?0:d.length;if(x)d.length=0,n.numberOfLines=0,D=0;let r=n.numberOfLines;for(let c=f;c<h;c++){let L=i[c],o=L.getBoundingClientRect();if(D+o.width<l)D+=o.width;else r++,D=o.width;d.push({lineIndex:r,word:L})}n.numberOfLines=r}async function J(){return await(await fetch("/words.json")).json()}function P(n){let e=JSON.parse(localStorage.getItem("typingStats")||"[]");if(e.length>=1e4)e.shift();e.push(n),localStorage.setItem("typingStats",JSON.stringify(e))}async function Q(){for(let n=60;n>0;n--)if(testState.isRunning)counter.innerText=n.toString(),await new Promise((d)=>setTimeout(d,1000));else return;counter.innerText="0"}function X(n,d,e,x,l,i,h){d.timeoutId=null,d.startTime=null,d.endTime=null,d.isRunning=!1,d.isFinished=!1,n.numberOfLines=0,n.lineIndex=0,n.lastLineIndex=0,n.numberOfWords=0,n.numberOfNewWords=0,n.wordIndex=0,n.charIndex=0,n.totalIndex=0,n.correctWords=0,n.incorrectCharacters=0,e.length=0,x.innerHTML="",l.innerText="60",i.focus(),h()}function Z(n,d,e){let x=(n-d)/1000;return e/x*60}function _(n,d,e){let x=(n-d)/1000;return e/5/(x/60)}function U(n,d){return((n-d)/n*100).toFixed(2)}function rn(n){let d=new Date(n),e={month:"short",day:"2-digit",weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1},l=new Intl.DateTimeFormat("en-US",e).formatToParts(d),i={};for(let h=0;h<l.length;h++)i[l[h].type]=l[h].value;return`${i.month} ${i.day}, ${i.weekday} - ${i.hour}:${i.minute}`}function K(n){let d="";if(n.ctrlKey)d+="control";if(n.metaKey)d+="meta";if(n.shiftKey)d+="shift";if(n.altKey)d+="alt";if(n.key==="ArrowLeft")n.preventDefault();if(n.key==="ArrowRight")n.preventDefault();if(n.key==="Backspace"){if(d.length>1)return n.preventDefault(),d+"Backspace";return d+"backspace"}if(n.key===" ")return n.preventDefault(),"space";return d+n.key}function G(n,d){let e=0;for(let x=0;x<d;x++){let i=n.children[x].classList;if(i.contains("completed")&&!i.contains("wrong"))e++}return e}function In(n){let d=Date.now(),e=new Date(d-performance.now()+n),x=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0"),h=String(e.getMilliseconds()).padStart(3,"0");return`${x}:${l}:${i}.${h}`}function k(n,d,e){let x=e.children[d.wordIndex],l=x.children[d.charIndex],i=e.parentElement.getBoundingClientRect();if(!l){let f=x.children[d.charIndex-1];if(!f)return;let r=f.getBoundingClientRect();n.style.transform=`translate(${r.x+r.width-i.x}px, ${r.y-i.y}px)`;return}let h=l.getBoundingClientRect();if(n.style.transform=`translate(${h.x-i.x}px, ${h.y-i.y}px)`,d.totalIndex===1)n.classList.add("typing")}function u(n,d,e){let x=e.children[d.wordIndex],l=x.children[d.charIndex-1];if(l)if(l.textContent===n){if(l.classList.add("typed"),d.charIndex===x.children.length)x.classList.add("completed")}else l.classList.add("wrong"),x.classList.add("wrong");else{let i=document.createElement("letter");i.innerText=n,i.classList.add("extra","wrong"),x.classList.add("wrong"),x.appendChild(i)}}function T(n,d){let e=d.children[n.wordIndex],x=e.children[n.charIndex];if(!x)return;if(x.classList.contains("extra")){x.remove();return}e.classList.remove("completed"),x.classList.remove("typed","wrong")}function O(n,d,e){let x=d.children[n.wordIndex],l=e.value.length-x.children.length;e.value=e.value.slice(0,l);let i=d.children[n.wordIndex].children;for(let h=i.length-1;h>=0;h--){let f=i[h];if(f.classList.contains("extra")){f.remove();continue}f.classList.remove("typed","wrong")}}function F(n,d){let e=d.children[n.wordIndex],x=e.children,l=x.length,i=!1;for(let h=0;h<l;h++)if(x[h].classList.contains("wrong")){i=!0;break}if(!i)e.classList.remove("wrong")}function N(n,d){let e=d.children[0].getBoundingClientRect().height;if(n.lastLineIndex>1)d.style.transform=`translateY(-${e*(n.lastLineIndex-1)}px)`}function $(n,d){let e=n.getBoundingClientRect();d.style.transform=`translate(${e.x}px, ${e.y}px)`}function b(n,d,e,x,l=!0){for(let i=0;i<d;i++){let h=Math.floor(Math.random()*250),f=n[h],r=document.createElement("div");r.classList.add("word");let c=f.split(""),L=c.length;for(let o=0;o<L;o++){let I=c[o],p=document.createElement("letter");p.innerText=I,r.append(p)}e.numberOfWords++,x.append(r)}if(!l)e.numberOfNewWords+=d}function m(n,d,e,x,l,i,h,f,r,c,L,o){if(e.addEventListener("click",()=>{l.focus(),i.classList.add("focus")}),window.addEventListener("resize",()=>{$(e,l),B(c,r,e,!0),w(c,r,!0,!0),N(c,e),k(i,c,e)}),l.addEventListener("focus",()=>{i.classList.add("focus")}),l.addEventListener("blur",()=>{i.classList.remove("focus")}),/Android/i.test(navigator.userAgent))l.addEventListener("beforeinput",(I)=>{if(I.inputType==="deleteContentBackward"){I.preventDefault(),(f.backspace||f.default)("backspace"),k(i,c,e),F(c,e);return}}),l.addEventListener("input",()=>{let p=l.value.slice(-1),R=p;if(p===" ")R="space";if((f[R]||f.default)(R),l.value="",!L.isRunning&&R.length===1&&R!==" ")L.isRunning=!0,L.startTime=performance.now(),L.startTest();k(i,c,e),F(c,e)});else l.addEventListener("keydown",(I)=>{o.key=I.key,o.keyCode=I.keyCode,o.ctrl=I.ctrlKey,o.shift=I.shiftKey,o.alt=I.altKey;let p=K(I);if((f[p]||f.default)(I.key),k(i,c,e),F(c,e),!L.isRunning&&I.key.length===1&&I.key!==" ")L.isRunning=!0,L.startTime=performance.now(),L.startTest()});h.addEventListener("click",()=>{X(c,L,r,e,x,l,()=>{b(n,d,c,e,!0),$(e,l),B(c,r,e,!0),w(c,r,!0,!0),N(c,e),k(i,c,e)})})}function E(n,d,e,x,l,i,h){d.default=(f)=>{if(f.length!==1)return;z(i),u(f,i,e),A(i,e)},d.space=()=>{Y(i,e),w(i,l,!0),N(i,e);let f=i.numberOfWords*0.5;if(i.wordIndex>=f)b(n,h,i,e,!1),B(i,l,e)},d.backspace=()=>{if(V(i,l,e))W(i,e),w(i,l),T(i,e)},d.altBackspace=()=>{if(V(i,l,e))j(i,e),O(i,e,x)},d.controlBackspace=d.altBackspace,d.metaBackspace=d.altBackspace}function H(n){let d=()=>`
    <div id="skeleton" style="position: absolute; top: 0; left: 0; width: 100%; display: flex; flex-wrap: wrap; gap: 0.875rem; padding: 0.5rem 0.5rem 0;">
      ${nn(100)}
    </div>
  `;n.innerHTML+=d()}function a(){document.querySelector("#skeleton").remove()}function nn(n){let d="";for(let e=0;e<n;e++)d+=`
      <div style="background-color: var(--color-neutral-200); width: ${en()}px; height: 28px; border-radius: 999px; animation: var(--animate-pulse)"></div>
    `;return d}function en(){return Math.floor(Math.random()*73)+48}var dn=document.querySelector("#counter"),y=document.querySelector(".words"),M=document.querySelector("#typing-input"),s=document.querySelector("#caret"),ln=document.querySelector("#restart-test"),q=[],g={numberOfLines:0,lineIndex:0,lastLineIndex:0,numberOfWords:0,numberOfNewWords:0,wordIndex:0,charIndex:0,totalIndex:0,correctWords:0,incorrectCharacters:0},C={timeoutId:null,startTime:null,endTime:null,startTest:(n)=>{},isRunning:!1,isFinished:!1},t={controlBackspace:(n)=>{},metaBackspace:(n)=>{},altBackspace:(n)=>{},space:(n)=>{},backspace:(n)=>{},default:(n)=>{}},xn={key:"",keyCode:"",ctrl:"",shift:"",alt:""},S=150,hn=150;H(y);var v=await J().finally(a);b(v,S,g,y);$(y,M);B(g,q,y,!0);m(v,S,y,dn,M,s,ln,t,q,g,C,xn);E(v,t,y,M,q,g,hn);k(s,g,y);C.startTest=()=>{Q(),C.timeoutId=setTimeout(()=>{C.endTime=performance.now(),C.isFinished=!0,M.blur(),g.correctWords=G(y,g.numberOfWords);let n=Math.round(Z(C.endTime,C.startTime,g.correctWords)),d=Math.round(_(C.endTime,C.startTime,g.totalIndex)),e=U(g.totalIndex,g.incorrectCharacters),x={wpm:n,rawWPM:d,accuracy:e,timestamp:Date.now()};P(x),window.location.href=`${window.location.origin}/results`},60000)};
