function B(n){n.charIndex++,n.totalIndex++}function R(n,d){if(n.wordIndex===0&&n.charIndex===0)return;if(n.charIndex===0){n.wordIndex--,n.totalIndex--,n.charIndex=d.children[n.wordIndex].children.length;return}n.totalIndex--,n.charIndex--}function $(n,d){if(n.charIndex===0)return;if(d.children[n.wordIndex].children[n.charIndex]!==void 0)n.incorrectCharacters++;n.wordIndex++,n.totalIndex++,n.charIndex=0}function b(n,d){if(n.wordIndex===0&&n.charIndex===0)return;if(n.charIndex!==0){n.totalIndex-=d.children[n.wordIndex].children.length,n.charIndex=0;return}n.wordIndex--,n.charIndex=0}function j(n,d){if(d.children[n.wordIndex].children[n.charIndex-1].classList.contains("wrong"))n.incorrectCharacters++}function y(n,d,e=!1,l=!1){let r=d[n.wordIndex].lineIndex;if(n.lineIndex=r,e&&l){n.lastLineIndex=r;return}if(e&&r>n.lastLineIndex)n.lastLineIndex=r}function t(n,d,e){let l=e.children[n.wordIndex],r=n.lastLineIndex-n.lineIndex,i=n.lastLineIndex-1,c=d.find((f)=>f.lineIndex===n.lineIndex)?.word||null,h=d.find((f)=>f.lineIndex===i)?.word||null;if(c===null||h===null)return!0;if(r<2&&n.charIndex===0&&l===h)return!1;return!0}var s=0;function k(n,d,e,l=!1){let r=e.parentElement.getBoundingClientRect().width,i=e.children,c=i.length,h=l?0:d.length;if(l)d.length=0,n.numberOfLines=0,s=0;let f=n.numberOfLines;for(let x=h;x<c;x++){let g=i[x],I=g.getBoundingClientRect();if(s+I.width<r)s+=I.width;else f++,s=I.width;d.push({lineIndex:f,word:g})}n.numberOfLines=f}async function V(){return await(await fetch("/words.json")).json()}function q(n){let e=JSON.parse(localStorage.getItem("typingStats")||"[]");if(e.length>=1e4)e.shift();e.push(n),localStorage.setItem("typingStats",JSON.stringify(e))}async function v(n,d){for(let e=60;e>0;e--)if(n.isRunning)d.innerText=e.toString(),await new Promise((l)=>setTimeout(l,1000));else return;d.innerText="0"}function m(n,d,e,l,r,i,c){d.timeoutId=null,d.startTime=null,d.endTime=null,d.isRunning=!1,d.isFinished=!1,n.numberOfLines=0,n.lineIndex=0,n.lastLineIndex=0,n.numberOfWords=0,n.numberOfNewWords=0,n.wordIndex=0,n.charIndex=0,n.totalIndex=0,n.correctWords=0,n.incorrectCharacters=0,e.length=0,l.innerHTML="",r.innerText="60",i.focus(),c()}function z(n,d,e){let l=(n-d)/1000;return e/l*60}function Y(n,d,e){let l=(n-d)/1000;return e/5/(l/60)}function Q(n,d){return((n-d)/n*100).toFixed(2)}function X(n){let d=new Date(n),e={month:"short",day:"2-digit",weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1},r=new Intl.DateTimeFormat("en-US",e).formatToParts(d),i={};for(let c=0;c<r.length;c++)i[r[c].type]=r[c].value;return`${i.month} ${i.day}, ${i.weekday} - ${i.hour}:${i.minute}`}function A(n){let d="";if(n.ctrlKey)d+="control";if(n.metaKey)d+="meta";if(n.shiftKey)d+="shift";if(n.altKey)d+="alt";if(n.key==="ArrowLeft")n.preventDefault();if(n.key==="ArrowRight")n.preventDefault();if(n.key==="Backspace"){if(d.length>1)return n.preventDefault(),d+"Backspace";return d+"backspace"}if(n.key===" ")return n.preventDefault(),"space";return d+n.key}function Z(n,d){let e=0;for(let l=0;l<d;l++){let i=n.children[l].classList;if(i.contains("completed")&&!i.contains("wrong"))e++}return e}function _(n){let d=Date.now(),e=new Date(d-performance.now()+n),l=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0"),c=String(e.getMilliseconds()).padStart(3,"0");return`${l}:${r}:${i}.${c}`}function C(n,d,e){let l=e.children[d.wordIndex],r=l.children[d.charIndex],i=e.parentElement.getBoundingClientRect();if(!r){let h=l.children[d.charIndex-1];if(!h)return;let f=h.getBoundingClientRect();n.style.transform=`translate(${f.x+f.width-i.x}px, ${f.y-i.y}px)`;return}let c=r.getBoundingClientRect();if(n.style.transform=`translate(${c.x-i.x}px, ${c.y-i.y}px)`,d.totalIndex===1)n.classList.add("typing")}function D(n,d,e){let l=e.children[d.wordIndex],r=l.children[d.charIndex-1];if(r)if(r.textContent===n){if(r.classList.add("typed"),d.charIndex===l.children.length)l.classList.add("completed")}else r.classList.add("wrong"),l.classList.add("wrong");else{let i=document.createElement("letter");i.innerText=n,i.classList.add("extra","wrong"),l.classList.add("wrong"),l.appendChild(i)}}function F(n,d){let e=d.children[n.wordIndex-1].children.length,l=d.children[n.wordIndex-1],r=(i)=>l.children[i].classList;for(let i=0;i<e;i++)if(!r(i).contains("typed")||r(i).contains("wrong"))l.classList.add("wrong","left")}function N(n,d){let e=d.children[n.wordIndex],l=e.children[n.charIndex];if(!l)return;if(l.classList.contains("extra")){e.classList.remove("left"),l.remove();return}e.classList.remove("completed","left"),l.classList.remove("typed","wrong")}function P(n,d,e){let l=d.children[n.wordIndex],r=e.value.length-l.children.length;e.value=e.value.slice(0,r);let i=d.children[n.wordIndex].children;for(let c=i.length-1;c>=0;c--){let h=i[c];if(h.classList.contains("extra")){l.classList.remove("left"),h.remove();continue}l.classList.remove("completed","wrong","left"),h.classList.remove("typed","wrong")}}function a(n,d){let e=d.children[n.wordIndex],l=e.children,r=l.length,i=!1;for(let c=0;c<r;c++)if(l[c].classList.contains("wrong")){i=!0;break}if(!i)e.classList.remove("wrong")}function w(n,d){let e=d.children[0].getBoundingClientRect().height;if(n.lastLineIndex>1)d.style.transform=`translateY(-${e*(n.lastLineIndex-1)}px)`}function W(n,d){let e=n.getBoundingClientRect();d.style.transform=`translate(${e.x}px, ${e.y}px)`}function u(n,d,e,l,r=!0){for(let i=0;i<d;i++){let c=Math.floor(Math.random()*250),h=n[c],f=document.createElement("div");f.classList.add("word");let x=h.split(""),g=x.length;for(let I=0;I<g;I++){let o=x[I],L=document.createElement("letter");L.innerText=o,f.append(L)}e.numberOfWords++,l.append(f)}if(!r)e.numberOfNewWords+=d}function O(){document.querySelector("#skeleton").remove()}function H(n,d,e,l,r,i,c,h,f,x,g,I){if(e.addEventListener("click",()=>{r.focus(),i.classList.add("focus")}),window.addEventListener("resize",()=>{W(e,r),k(x,f,e,!0),y(x,f,!0,!0),w(x,e),C(i,x,e)}),r.addEventListener("focus",()=>{i.classList.add("focus")}),r.addEventListener("blur",()=>{i.classList.remove("focus")}),/Android/i.test(navigator.userAgent))r.addEventListener("beforeinput",(o)=>{if(o.inputType==="deleteContentBackward"){o.preventDefault(),(h.backspace||h.default)("backspace"),C(i,x,e),a(x,e);return}}),r.addEventListener("input",()=>{let L=r.value.slice(-1),p=L;if(L===" ")p="space";if((h[p]||h.default)(p),r.value="",!g.isRunning&&p.length===1&&p!==" ")g.isRunning=!0,g.startTime=performance.now(),g.startTest();C(i,x,e),a(x,e)});else r.addEventListener("keydown",(o)=>{I.key=o.key,I.keyCode=o.keyCode,I.ctrl=o.ctrlKey,I.shift=o.shiftKey,I.alt=o.altKey;let L=A(o);if((h[L]||h.default)(o.key),C(i,x,e),a(x,e),!g.isRunning&&o.key.length===1&&o.key!==" ")g.isRunning=!0,g.startTime=performance.now(),g.startTest()});c.addEventListener("click",()=>{m(x,g,f,e,l,r,()=>{u(n,d,x,e,!0),W(e,r),k(x,f,e,!0),y(x,f,!0,!0),w(x,e),C(i,x,e)})})}function S(n,d,e,l,r,i,c){d.default=(h)=>{if(h.length!==1)return;B(i),D(h,i,e),j(i,e)},d.space=()=>{$(i,e),y(i,r,!0),F(i,e),w(i,e);let h=i.numberOfWords*0.5;if(i.wordIndex>=h)u(n,c,i,e,!1),k(i,r,e)},d.backspace=()=>{if(t(i,r,e))R(i,e),y(i,r),N(i,e)},d.altBackspace=()=>{if(t(i,r,e))b(i,e),P(i,e,l)},d.controlBackspace=d.altBackspace,d.metaBackspace=d.altBackspace}export{H as setInputListeners,S as setInputHandlers};
